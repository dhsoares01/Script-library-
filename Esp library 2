-- PathESP.lua
-- Biblioteca ESP simples para Delta executores
-- Cria uma linha entre o jogador local e um objeto alvo
-- Ativar/desativar: PathESP:Enable() e PathESP:Disable()

local PathESP = {}
PathESP.Enabled = false
PathESP.Target = nil -- endereço do objeto, ex: workspace.Part
PathESP.Line = nil

-- Cria o objeto Line (Drawing API)
function PathESP:CreateLine()
    local line = Drawing.new("Line")
    line.Color = Color3.fromRGB(255, 0, 0)
    line.Thickness = 2
    line.Transparency = 1
    return line
end

-- Atualiza a linha a cada frame
function PathESP:Update()
    local RunService = game:GetService("RunService")
    self.Connection = RunService.RenderStepped:Connect(function()
        if not self.Enabled or not self.Line or not self.Target then return end

        local player = game.Players.LocalPlayer
        if not player or not player.Character or not player.Character:FindFirstChild("HumanoidRootPart") then return end

        local hrp = player.Character.HumanoidRootPart
        local target = self.Target

        -- Converte posições 3D para tela (viewport)
        local camera = workspace.CurrentCamera
        local screenPos1, onScreen1 = camera:WorldToViewportPoint(hrp.Position)
        local screenPos2, onScreen2 = camera:WorldToViewportPoint(target.Position)

        if onScreen1 and onScreen2 then
            self.Line.Visible = true
            self.Line.From = Vector2.new(screenPos1.X, screenPos1.Y)
            self.Line.To = Vector2.new(screenPos2.X, screenPos2.Y)
        else
            self.Line.Visible = false
        end
    end)
end

-- Ativa o ESP
function PathESP:Enable()
    if self.Enabled then return end
    if not self.Target then
        warn("[PathESP] Defina um alvo primeiro usando PathESP.Target = workspace.Part")
        return
    end
    self.Line = self:CreateLine()
    self.Enabled = true
    self:Update()
end

-- Desativa o ESP
function PathESP:Disable()
    self.Enabled = false
    if self.Line then
        self.Line:Remove()
        self.Line = nil
    end
    if self.Connection then
        self.Connection:Disconnect()
        self.Connection = nil
    end
end

return PathESP
